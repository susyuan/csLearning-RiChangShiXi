# 日常实习-Redis面试题

小林coding:面试题

[3 万字 + 40 张图 ｜ Redis 常见面试题（2023 版本） (qq.com)](https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247527565&idx=2&sn=f052a879d5c6c6c6cb69f4de668e71bd&chksm=f98d2827cefaa13182a5d8075187674e805368fab508bea2b7d5429aec1af2092df3e59571db&scene=178&cur_album_id=1790401816640225283#rd)

1. [(1条消息) 10题经典Redis面试题_努力学习的小白灬的博客-CSDN博客](https://blog.csdn.net/m0_52256357/article/details/125709819?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-14-125709819-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
2. [(1条消息) 面试还搞不懂redis，快看看这40道面试题（含答案和思维导图）_程序员追风的博客-CSDN博客](https://blog.csdn.net/Design407/article/details/103242874?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-10-103242874-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
3. [(1条消息) 「面试必背」Redis面试题（2022最新版）_redis面试必会6题经典_90后小伙追梦之路的博客-CSDN博客](https://blog.csdn.net/m0_67322837/article/details/125372575?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-9-125372575-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
4. [(1条消息) 全网最硬核 Redis 高频面试题解析（2021年最新版）_程序员囧辉的博客-CSDN博客](https://blog.csdn.net/v123411739/article/details/116109674?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-8-116109674-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
5. [(1条消息) JAVA经典面试题附答案(持续更新版)_java面试题_是华仔呀的博客-CSDN博客](https://blog.csdn.net/weixin_43495390/article/details/86533482?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-7-86533482-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
6. [(1条消息) 2023年Redis面试题（持续更新）_redis面试题2023_Geek-Banana的博客-CSDN博客](https://blog.csdn.net/qq1515312832/article/details/113880849?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-6-113880849-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
7. [(1条消息) 几率大的Redis面试题（含答案）__睶_的博客-CSDN博客](https://blog.csdn.net/Butterfly_resting/article/details/89668661?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-5-89668661-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
8. [(1条消息) redis面试题总结（附答案）_哪 吒的博客-CSDN博客](https://blog.csdn.net/guorui_java/article/details/117194603?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-4-117194603-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
9. [(1条消息) Redis面试题总结（2022最新版）_程序猿周周的博客-CSDN博客](https://blog.csdn.net/adminpd/article/details/122934938?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-122934938-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
10. [(1条消息) Redis面试题（2020最新版）_ThinkWon的博客-CSDN博客](https://blog.csdn.net/ThinkWon/article/details/103522351?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-2-103522351-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
11. [(1条消息) 20道经典Redis面试题_CSDN砖家的博客-CSDN博客](https://blog.csdn.net/weixin_40205234/article/details/124614720?ops_request_misc=%7B%22request%5Fid%22%3A%22168812811116800185863616%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=168812811116800185863616&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-124614720-null-null.142^v88^control_2,239^v2^insert_chatgpt&utm_term=redis面试题&spm=1018.2226.3001.4187)
12. 

# 搜集滴滴

6.Redis的持久化机制了解不了解？

​	AOF、AOF重写、RDB、混合。最搞笑的是，我把 binlog的3种格式（statement、row、mixed）记成了AOF的3种格式，一面二面我都这样说了，估计面试官也没想起来，也没说我有错。

7.问我主要用过 Redis 哪种数据结构，知不知道其底层原理？我回答了String的SDS原理，还回答了用了 MAP 做抢票的 Redis 内存标记。

4.怎样保证Redis预减库存不会出错呢？我一开始以为是MySQL、Redis数据同步的问题，还讲了一下RabbitMQ的持久化，后来才反应过来问的是Redis持久化机制。

5.你简历上说到了解关系型数据库MySQL和非关系型数据库Redis，那你为什么选用Redis和MySQL来做这个项目？随便说了下，不太懂。。。就MySQL好建表来当库存嘛，用Redis的话，它是高效缓存，能不能处理高并发情况。

6.**为什么Redis这么高效？**虽然单线程，但主要操作在内存中完成，瓶颈不是CPU等等八股，还回答到 I/O 多路复用机制，能处理多个 Socket 请求。
后面的问题都拓展了项目的情景，我只能记起来个大概。
7.如果我现在有这么一个场景，有一个演唱会抢票，我有3个演唱会抢票场次，每场100张票，该怎样实现？凭感觉回答分批次将100张票来初始化到Redis。
8.你的意思是，串行化实现对吧，那如果我3个抢票场次是同一时间进行的呢？回答了用Redis的Pipeline来进行批处理并行执行。
9.那你在一个Redis中执行，怎样确定是哪个场次的呢，你是不同场次同时抢票的呀？想了一会儿，用票的ID来进行判断，1~100就第一场这样。面试官说，可以在KEY上加上场次的ID，后来感觉确实比票ID更简单。
好像就这么些项目问题了。。。

\19. **Redis怎么实现短信验证登陆**
**\20. Redis缓存击穿、缓存雪崩、缓存穿透**

redis为什么这么快 单线程为什么这么快

简述项目，有几张表，项目中redis用来干嘛
场景题 数据库 redis一致性 先更新数据库再删缓存  先删除缓存再更新数据库（这要用到延时双删来保证一致性） 延时双删怎样实现的 加锁 只准一个线程操作



redis为什么这么快 单线程为什么这么快

1. Redis 用在哪里了，用了什么数据结构，为什么；不同数据结构的应用场景
2. Redis 缓存穿透怎么回事，怎么解决
3. 项目的难点，重点（讲了 Redis 数据一致性、缓存穿透）
4. Redis 分布式怎么做，知道哨兵吗

![image-20230719230224458](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307192302518.png)

redis数据结构，如何实现

2.为什么要将热点数据放在Redis中

3.Redis的同步策略有什么（说错了，说成缓存更新策略了）

4.缓存穿透的产生原因和解决策略（布隆过滤器忘说了）



7.如果你自己设计一个类似Redis的缓存系统，你会考虑哪些问题（先整体设计，再设计细节）

8.Redis常用的数据类型以及他们的应用

9.Redis中的zset，如何实现一个排行榜的功能。



4.项目中用到了redis，介绍一下redis的架构
5.redis的线程模型



Redis在项目中的作用
缓存用啥结构
Redis存String转map和直接存map的区别
Redis持久化方式

3.redis 用的什么模式
4.哨兵模式和集群模式的区别5.哪一个支持的并发度更高6.

1.redis的持久化，AOF重写，数据结构，使用方式

\19. Redis为什么快？
\20. Redis的缓存穿透、缓存击穿以及缓存雪崩
\21. 布隆过滤器有哪一些缺点？

# 搜集的哈啰面试

1.mysql和redis怎么用的分布式锁
2.两个线程同时修改同一条数据时怎么增加并发

\11. Redis除了缓存之外，还有什么使用场景
\12. Redis生成唯一主键的思路，是生成后存放在Redis中等待使用还是请求时临时生成
\13. Redis的跳表

3、Redis 缓存过期触发回调函数处理订单超时关闭？有没有其他办法。

16、Redis事务过程原理？(开启事务，版本号机制实现)
17、Redis五大数据类型的使用场景。
18、Redis 缓存穿透、缓存雪崩、缓存击穿。如何解决
19、Redis的持久化机制。有什么优缺点。
20、Redis如何找出大量以某一个前缀开头的key。(有什么命令，不会)

12.redis缓存击穿 雪崩 穿透

13.持久化技术

14.分片集群

15.哨兵机制

16.淘汰策略

1. 秒杀怎么保证数据一致的，解决超卖
2. redis主要做了什么
3. 缓存穿透
4. 异步秒杀
5. 分布式锁实现原理
6. 分布式锁结构
7. 8、Redis过期删除策略 持久化方式

**Redis数据结构，sds（这里是面试官看我博客有写）**

3、`Redis`存储登录凭证具体怎么做的？

4、存储数据的`Redis`挂掉了怎么办？

5、`Redis`怎么持久化的？

6、`Redis`集群说一下

7、用`HyperLogLog`、`Bitmap`，当时怎么思考的？

8、它们是怎么实现的？

2、介绍项目里的redis实现点赞怎么实现的；redis 宕机了，数据没有存进去怎么办？集群了解过吗？redis过期淘汰策略

---

介绍项目里的redis实现点赞怎么实现的；redis 宕机了，数据没有存进去怎么办？集群了解过吗？redis过期淘汰策略

3、`Redis`存储登录凭证具体怎么做的？

4、存储数据的`Redis`挂掉了怎么办？

5、`Redis`怎么持久化的？

6、`Redis`集群说一下

7、用`HyperLogLog`、`Bitmap`，当时怎么思考的？

8、Redis过期删除策略 持久化方式

---

缓存数据库不一致怎么解决

MySQL和redis怎么保证数据一致性

---

1. 秒杀怎么保证数据一致的，解决超卖
2. redis主要做了什么
3. 缓存穿透
4. 异步秒杀
5. \- redis数据结构有哪几种，它们分别对应的应用场景

---

了解Redis缓存吗，项目中key有没有失效时间，怎么设计的

---

12.redis缓存击穿 雪崩 穿透--

13.持久化技术--

14.分片集群

15.哨兵机制

16.淘汰策略--

---

16、Redis事务过程原理？(开启事务，版本号机制实现)
17、Redis五大数据类型的使用场景。
18、Redis 缓存穿透、缓存雪崩、缓存击穿。如何解决
19、Redis的持久化机制。有什么优缺点。
20、Redis如何找出大量以某一个前缀开头的key。(有什么命令，不会)

3、Redis 缓存过期触发回调函数处理订单超时关闭？有没有其他办法。

---

redis底层数据结构

14.分片集群

15.哨兵机制

16.淘汰策略

 redis怎么做主从、集群、

# 黑马点评项目



**探店笔记**

图片上传是uploadecontroller  已经实现

缓存

查看笔记 包含用户信息 实体类加了字段 且标注表里面没有

**点赞+排行榜实现**

解决 1无限点赞 2排序   zset集合

stringRedisTemplate.opsForZSet

score使用时间戳，越早点赞排名越前 类似微信朋友圈

 zset集合 存储 点赞 保证点赞用户唯一 且有排序功能 **分数从小到大**

查询是否存在（指定成员分数

~~~
redis 127.0.0.1:6379> ZSCORE key member
返回分数值
~~~

点赞  数据库 liked  字段+1

添加zadd

命令

~~~
zrange student 0 -1 //查询所有元素
zrange zset 0 i  //0到i之前的元素
zrange zset 0 i  withscores//0到i之前的元素 带评分
zrangebyscore student 20 70 //查询score 20-70之间
zrevrangebyscore student 20 70 //数据从大到校排序
//添加
zadd student 60 Tom 72 Jerry 49 Jack 81 Bill
//删除
zrem student Tom
//增加
zincrby student 20 Tom
~~~

**好友关注**

表 tb_follow  主要存储用户id和关联的用户id

每一行数据是一个 a关注b记录

set集合操作

~~~
SADD key member1 [member2]
向集合添加一个或多个成员
SCARD key
获取集合的成员数
SREM key member1
	SINTER key1 [key2]
返回给定所有集合的交集   （共同关注
~~~

**秒杀**

1订单表要用全局唯一id  



2新增优惠券 

tb_voucher：普通券
tb_seckill_voucher：特价优惠券才需要填写；优惠券的库存、开始抢购时间，结束抢购时间

特价券有时间数量限制

3秒杀下单 接口

vouchordercontroller

- 判断开始结束时间和库存
- 判断库存再扣减库存 然后创建订单 订单id用全局id 代码1
- 问题
  - **超卖** 库存1时同时两个线程减库存 加锁 悲观vs乐观
  - 乐观锁解决超卖 操作时version+1 
  - 实际解决  库存>0就可以减去（库存=查询时候库存 失败概率太大）代码2
  - **一人一单问题** 避免重复下单
  - 判断库存后 订单前加一人一单判断逻辑 订单表 查询（优惠券id，用户id）
  - **一人一单并发问题** 都判断没有重复订单 同时插入数据库
  - 解决；乐观锁适合更新 直接比对原数据  悲观锁适合插入 代码3 syn和@Trasactional注解 锁住三部分
  - **集群下多个JVM 上述一人一单的syn锁失效**，用分布式锁 代码4
  - **分布式锁 获取锁后宕机 锁永远不释放**->t添加超时释放
  - **误删问题** ：超时释放后以为自己还有锁 释放了别人的锁->判断锁的标识是否一致再释放（前面value是线程id，JVM线程标识可能重复，改为uuid+线程id
  - **误删问题  极端情况**：释放自己锁的时候，判断锁标识和释放锁原子性不一致  判断完后 阻塞 超时释放  然后主动释放了别的线程的锁->lua脚本  execute执行lua脚本

**秒杀优化-消息队列**

前面下单逻辑，大量操作mysql 性能不好

把下单判断和操作库分开  redis存库存

![image-20230727101844334](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307271018403.png)

判断能否下单的逻辑放入redis 后台慢慢执行数据库的

redis判断：看库存和是否下过单，然后userid和优惠券存入redis，过程要用lua操作

![image-20230727102354400](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307271023474.png)

版本1 阻塞队列

版本2 消息队列

**共同关注**

set集合 SINTER s1 s2实现

要把关注列表放入redis  因此关注的时候要保存进redis

**feed流**

timline 推模式  因为用户不多，发送笔记就往所有粉丝的收件箱发（关注前发送的不会在推模式里面

保存blog 时 获取用户所有粉丝（数据库），往粉丝redis 里zset直接放blogid作为member  时间戳score

zset 实现 分页查询

滚动分页查询（因为列表会变化，不是正常分页查询

zrange key min max  查询范围内  

倒叙查询 最晚发的在最上面

四个参数

![image-20230710125444257](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307262307506.png)

## redis在项目中的作用（redis主要做了什么

1用redis替代session 存储

2分布式锁

3消息队列

4用作mysql缓存

5zset点赞排行榜

6set集合求交集 共同关注

## 缓存用啥结构

String  Hash

## Redis存String转map和直接存map的区别



## 秒杀怎么保证数据一致的，解决超卖



## 异步秒杀



# 基础

## --什么是redis

是基于内存的数据库，存储**键值对**，读写速度快，常用于缓存、分布式锁、消息队列；

- 内置多种数据类型 string set zset hash list 五大数据结构
- 支持事务和持久化机制
- 读写性能好

缺点：数据库容量受到物理内存的限制

## --为什么用作mysql缓存

1访问mysql数据从硬盘读取，redis是内存数据库 作为msyql缓存后，从内存读取数据 性能好 （修改数据时会出现双写一致性问题

2 直接访问redis能够承受请求远远大于mysql

## 为什么redis这么高效（这么快

- 内存存储：

- 单线程实现（redis6.0以前 ）：Redis使用单个线程处理请求，避免了多个线程之间线程切换和锁资源争用的开销。   注意：单线程是指的是在核心网络模型中，网络请求模块使用一个线程来处理，即一个线程处理所有网络请求。

- 虽然单线程，但主要操作在内存中完成，瓶颈不是CPU

  I/O多路复用机制  一个线程处理多个IO刘，监听这些端口的连接请求

## redis使用场景

缓存 分布式锁  消息队列

## Redis除了缓存之外，还有什么使用场景

分布式锁 消息队列

## Redis生成唯一主键的思路，是生成后存放在Redis中等待使用还是请求时临时生成



## Redis 缓存过期触发回调函数处理订单超时关闭？



## redis用在哪 用了什么数据结构

zset  点赞排行榜

set  好友关注

stream 秒杀异步

## 怎样保证Redis预减库存不会出错呢？

我一开始以为是MySQL、Redis数据同步的问题，还讲了一下RabbitMQ的持久化，后来才反应过来问的是Redis持久化机制。

## 你简历上说到了解关系型数据库MySQL和非关系型数据库Redis，那你为什么选用Redis和MySQL来做这个项目？

随便说了下，不太懂。。。就MySQL好建表来当库存嘛，用Redis的话，它是高效缓存，能不能处理高并发情况。



## 如果我现在有这么一个场景，有一个演唱会抢票，我有3个演唱会抢票场次，每场100张票，该怎样实现？

凭感觉回答分批次将100张票来初始化到Redis。

8.你的意思是，串行化实现对吧，那如果我3个抢票场次是同一时间进行的呢？回答了用Redis的Pipeline来进行批处理并行执行。
9.那你在一个Redis中执行，怎样确定是哪个场次的呢，你是不同场次同时抢票的呀？想了一会儿，用票的ID来进行判断，1~100就第一场这样。面试官说，可以在KEY上加上场次的ID，后来感觉确实比票ID更简单。
好像就这么些项目问题了。。。

## redis怎么实现短信验证登录

校验手机号格式是否正确 发送验证码  保存验证码到redis  用户手机号作为key

然后填写验证码后  比对redis存储的验证码   然后判断用户是否存在 不存在要创建用户 设置token 作为登录凭证  uuid生成





## redis为什么这么快 单线程为什么这么快



## 如果你自己设计一个类似Redis的缓存系统，你会考虑哪些问题（先整体设计，再设计细节）

## 项目中用到了redis，介绍一下redis的架构



# 线程模型

## --redis是单线程吗

单线程指的是**「接收客户端请求->解析请求 ->进行数据读写等操作->发送数据给客户端」这个过程是由一个线程（主线程）来完成的**

redis会启动后台线程  

1处理关闭文件

2 AOF刷盘

## --redis单线程还那么快（网络I/O和执行命令

- redis大部分操作都在内存中完成，redis瓶颈并非CPU
- 避免了**多线程之间的竞争**，省去了多线程切换带来的时间和性能上的开销，而且也不会导致死锁问题。
- I/O多路复用机制：处理大量的客户端Socket请求；
  - ，IO 多路复用机制是指一个线程处理多个 IO 流，就是我们经常听到的 select/epoll 机制。简单来说，在 Redis 只运行单线程的情况下，该机制允许内核中，同时存在多个监听 Socket 和已连接 Socket。内核会一直监听这些 Socket 上的连接请求或数据请求。一旦有请求到达，就会交给 Redis 线程处理，这就实现了一个 Redis 线程处理多个 IO 流的效果。



## --redis6.0后为何引入多线程

6.0后引入多个I/O线程处理网络请求，随着网络硬件性能的提升，Redis的性能有时会出现在网络I/O的处理上

**但是对于命令的执行，Redis 仍然使用单线程来处理**

## Redis如何找出大量以某一个前缀开头的key。(有什么命令，不会)

# 数据类型

## Redis常见数据类型及其使用场景（5+4）

### String



### List



### Hash



### Set



### Zset

list set zset string hash

- String 类型的应用场景：缓存对象为JSON、常规计数、**分布式锁**、共享 session 信息等。
- List 类型的应用场景：消息队列（但是有两个问题：1. 生产者需要自行实现全局唯一 ID；2. 不能以消费组形式消费数据）等。
- Hash 类型：**缓存对象、购物车**等。
- Set 类型：聚合计算（并集、交集、差集）场景，比如**点赞**、**共同关注**、抽奖活动等。
- Zset 类型：**排序场景，比如排行榜**、电话和姓名排序等。

---

- BitMap（2.2 版新增）：二值状态统计的场景，比如签到、判断用户登陆状态、连续签到用户总数等；
- HyperLogLog（2.8 版新增）：海量数据基数统计的场景，比如百万级网页 UV 计数等；
- GEO（3.2 版新增）：存储地理位置信息的场景，比如滴滴叫车；
- Stream（5.0 版新增）：消息队列，相比于基于 List 类型实现的消息队列，有这两个特有的特性：自动生成全局唯一消息ID，支持以消费组形式消费数据。

## redis数据结构的底层原理

![img](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202309051701384.png)

### SDS



### 链表





### 压缩列表





### 哈希表



### 整数集合



### 跳表





### quicklist



### listpack



### 

## 主要用过 Redis 哪种数据结构，知不知道其底层原理？

string底层  简单动态字符串SDS  

- 不仅保存文本数据，还可以保存二进制数据
- 获取字符串长度时间复杂度O(1)



List底层quicklist



Hash底层   **listpack**或哈希表

set 哈希表或者整数集合

zset listpack或者跳表

## redis底层数据结构

## 不同数据结构应用场景

## Redis中的zset，如何实现一个排行榜的功能。

黑马点评实现 key value score

## `Redis`存储登录凭证具体怎么做的？

token，前端访问会带有token

## 用`HyperLogLog`、`Bitmap`，当时怎么思考的？

## `HyperLogLog`、`Bitmap`怎么实现



## 介绍项目里的redis实现点赞怎么实现的

## redis 宕机了，数据没有存进去怎么办？



## 了解Redis缓存吗，项目中key有没有失效时间，怎么设计的

用户登录凭证  30min

验证码2分钟



## 4、存储数据的`Redis`挂掉了怎么办？



# 事务

## --概念

单个redis命令执行是原子性，redis事务不是原子性，理解为打包的批量执行的脚本，中间失败的指令不会引起回滚，也不影响后续指令执行

- 具有隔离性，不会被其他命令请求打断

## Redis事务过程原理？(开启事务，版本号机制实现)

四个命令  multi  exec  discard  watch

1. 开始事务（`MULTI`）；
2. 命令入队(批量操作 Redis 的命令，先进先出（FIFO）的顺序执行)；
3. 执行事务(`EXEC`)。

discard清空事务队列

watch监控  如果命令被修改  就执行失败

# 持久化

## 简述redis持久化机制。有什么优缺点。

## 概念

redis读写操作在内存中，防止内存数据丢失

持久化是为了重用redis数据，或者防止系统故障，要把数据写入磁盘

redis默认持久化是RDB，重启加载之前的快照

## 持久化方式

持久化有三种方式

1.快照rdb

2.只追加文件AOF

3.混合持久化 redis4.0新增

### 1 RDB 快照

概念：指定的时间间隔内把**内存中的数据集快照**写入磁盘，恢复时是将快照文件直接读入内存；

特点

- 记录某一瞬间的内存数据，记录实际数据
- 回复效率更高，只需将RDB文件读入内存，无需执行写操作命令
- 使用：save bgsave命令生成快照文件  save会阻塞主线程  bgsasve不会阻塞主线程 生成子进程
- 也可配置redis.conf文件  后台生成

优点：

适合大规模数据恢复，对数据完整性和一致性要求不高

缺点：

间隔一段时间备份，宕机时会丢失最后一次快照后的修改



### 2 AOF文件

概念 ：以日志形式记录每个写操作，记录写命令，只许追加不可改写文件，redis启动之初会读取该文件重新构建数据（根据写指令从前往后执行恢复数据

>  用 AOF 日志的方式来恢复数据其实是很慢的，因为 Redis 执行命令由单线程负责的，而 AOF 日志恢复数据的方式是顺序执行日志里的每一条命令，如果 AOF 日志很大，这个「重放」的过程就会很慢了。

特点

- 默认不开启，修改redis.conf
- 只记录写操作命令，读操作无意义
- 先执行写操作命令后，才将该命令记录到 AOF 日志
  - 好处 
    - 1避免额外的检查开销 （先记录命令需要检查命令是否正确
    - 2不会阻塞当前写操作命令的执行
- 风险： 1写操作命令和记录日志两个过程，有丢失数据风险 2不会阻塞当前写命令，但有可能阻塞下一个命令，因为写入日志的操作也是主进程完成

三种写回策略

写命令会加载到缓冲区，再到内核缓冲区  何时写入磁盘 三种策略

- always：写操作后就写回（最大程度保证数据不丢失，影响主进程的性能；
- everysec：每隔一秒将内核缓冲区的内容写回硬盘（如果上一秒的写操作命令日志没有写回到硬盘，发生了宕机，这一秒内的数据自然也会丢失。
- no ：操作系统决定何时写回硬盘（操作系统写回硬盘的时机是不可预知的，如果 AOF 日志内容没有写回硬盘，一旦服务器宕机，就会丢失不定数量的数据。

![image-20230723232436974](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307232324073.png)

三种策略区别是调用fsync函数的时机

流程

**命令追加（append）**：所有的写命令会追加到 AOF 缓冲区中。

**文件写入（write）**：将 AOF 缓冲区的数据写入到 AOF 文件中。这一步需要调用`write`函数（系统调用），`write`将数据写入到了系统内核缓冲区之后直接返回了（延迟写）。注意！！！此时并没有同步到磁盘。

**文件同步（fsync）**：AOF 缓冲区根据对应的持久化方式（ `fsync` 策略）向硬盘做同步操作。这一步需要调用 `fsync` 函数（系统调用）， `fsync` 针对单个文件操作，对其进行强制硬盘同步，`fsync` 将阻塞直到写入磁盘完成后返回，保证了数据持久化。

**文件重写（rewrite）**：随着 AOF 文件越来越大，需要定期对 AOF 文件进行重写，达到压缩的目的。

**重启加载（load）**：当 Redis 重启时，可以加载 AOF 文件进行数据恢复。



优点

aof数据安全性较好，每次写操作都生成

只追加写操作命令到aof文件， rdb是保存快照数据集，较为复杂

缺点

1 aof文件大于rdb文件  恢复速度慢

2 aof运行效率慢  每秒同步效率较好

### 3 RDB和AOF结合



## 如何选择某一种持久化方式

数据安全性要求高选择AOF

可以忍受文件丢失RDB

## --AOF重写机制

对AOF文件瘦身  对一个属性的多次修改只用保存最后一次的写命令



# 功能篇

## 过期删除策略



## 内存淘汰策略



# 缓存

缓存过多需要删除/更新

涉及三个问题

内存淘汰 八个策略

超时剔除 三种策略

主动更新 四种方案

![1653322506393](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307241700053.png)

## 过期删除策略

redis采用**惰性删除+定期删除**配合使用

常用三种：

- 定时删除
- 惰性删除
- 定期删除

**定时删除**

做法

**在设置 key 的过期时间时，同时创建一个定时事件，当时间到达时，由事件处理器自动执行 key 的删除操作。**

优点

对内存最友好，尽快删除

缺点

占用CPU时间，过期key多时，内存不紧张CPU紧张的时候效率受影响

**惰性删除**

**不主动删除过期键，每次从数据库访问 key 时，都检测 key 是否过期，如果过期则删除该 key。**

优点

对CPU时间最友好

缺点

过期key没有被访问，就一直留在数据库中，

**定期删除**

**每隔一段时间「随机」从数据库中取出一定数量的 key 进行检查，并删除其中的过期key。**

优点

- 通过限制删除操作执行的时长和频率，来减少删除操作对 CPU 的影响，同时也能删除一部分过期的数据减少了过期键对空间的无效占用。

缺点

- 内存清理方面没有定时删除效果好，同时没有惰性删除使用的系统资源少。
- 难以确定删除操作执行的时长和频率。如果执行的太频繁，定期删除策略变得和定时删除策略一样，对CPU不友好；如果执行的太少，那又和惰性删除一样了，过期 key 占用的内存不会及时得到释放。

redis如何实现惰性删除



redis如何实现定期删除



## 内存淘汰策略

> 过期删除策略，是删除已过期的 key；
>
> 内存淘汰：当 Redis 的运行内存已经超过 Redis 设置的最大内存之后，则会使用内存淘汰策略删除符合条件的 key，以此来保障 Redis 高效的运行。

八种

1. 不进行数据淘汰
   1. noeviction 默认的不淘汰任何数据
2. 进行数据淘汰
   1. 设置的过期时间的数据淘汰
      1. volatile-random
      2. volatile-ttl 优先淘汰更早过期的键值
      3. volatile-lru
      4. volatile-lfu
   2. 在所有数据范围内进行淘汰
      1. allkeys-random
      2. allkeys-lru 最久未使用
      3. allkeys-lfu 最少使用

## 缓存更新策略=缓存读写策略

该策略解决的是 修改数据库的同时如何修改缓存

![image-20230724165110286](https://duoduo-img.oss-cn-shenzhen.aliyuncs.com/202307241651359.png)

**cache aside pattern旁路缓存模式**

适合读请求比较多的场景

Cache Aside Pattern 中服务端需要同时维系 db 和 cache，并且是以 db 的结果为准。



## mysql和redis双写一致性（四种方案

修改数据时，数据库数据会变化，要保证缓存和数据库数据同步

没有必要每次都更新缓存，因为更新操作实际上只有最后一次生效，我们可以把缓存删除，等待再次查询时，将缓存中的数据加载出来

四种方案

1.先更新数据库，再更新缓存

2.先更新缓存，再更新数据库：

3.先删除缓存，后更新数据库√

4.先更新数据库，后删除缓存

---





### 1先删除缓存再更新数据库

（这要用到延时双删来保证一致性） 延时双删怎样实现的 加锁 只准一个线程操作

该方案会出问题：

请求 1 先写数据 A，请求 2 随后读数据 A 的话，就很有可能产生数据不一致性的问题。

这个过程可以简单描述为：

> 请求 1 先把 cache 中的 A 数据删除 -> 请求 2 从 db 中读取数据->请求 1 再把 db 中的 A 数据更新

------

---

请求 A（更新操作） 和请求 B（查询操作）

1. 请求A进行写操作，删除缓存
2. 请求B查询发现缓存不存在
3. 请求B去数据库查询得到旧值
4. 请求B将旧值写入缓存
5. 请求A将新值写入数据库

导致不一致的情况出现；如果不给缓存设置过期时间策略 数据永远脏数据

解决方法

1.延时双删

2.更新与读取操作进行异步串行化

### 2先更新数据库再删缓存  

问题：

情况1

如果更新数据库成功，删除缓存失败，此时读取缓存是错误的数据

情况2

请求 1 先读数据 A，请求 2 随后写数据 A，并且数据 A 在请求 1 请求之前不在缓存中的话，也有可能产生数据不一致性的问题。

这个过程可以简单描述为：

> 请求 1 从 db 读数据 A-> 请求 2 更新 db 中的数据 A（此时缓存中无数据 A ，故不用执行删除缓存操作 ） -> 请求 1 将数据 A 写入 cache



## Redis的同步策略有什么（更新策略

三种

## 什么是缓存穿透 如何解决

缓存穿透是指**缓存和数据库中都没有的数据**，而用户不断发起请求。

- 第一种方案，非法请求的限制；
- 第二种方案，缓存空值或者默认值；
- 第三种方案，使用布隆过滤器快速判断数据是否存在，避免通过查询数据库来判断数据是否存在；

## 布隆过滤器有什么缺点



## 什么是缓存击穿 如何解决

缓存击穿是指**缓存中没有但数据库中有的数据**（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力。

主要指**热点数据**

- 互斥锁方案，保证同一时间只有一个业务线程更新缓存，未能获取互斥锁的请求，要么等待锁释放后重新读取缓存，要么就返回空值或者默认值。
- 不给热点数据设置过期时间，由后台异步更新缓存，或者在热点数据准备要过期前，提前通知后台线程更新缓存以及重新设置过期时间；

## 什么是缓存雪崩 如何解决

缓存雪崩是指缓存中**数据大批量到过期时间or redis宕机，而查询数据量巨大，引起数据库压力过大甚至down机**。

- 大量数据同时过期
  - 均匀设置过期时间；
  - 互斥锁；
  - 双 key 策略；
  - 后台更新缓存；
- redis故障宕机
  - 服务熔断或请求限流机制；
  - 构建 Redis 缓存高可靠集群；

# 分布式锁

## 什么是分布式锁

锁就是同步工具，保证共享资源同一时刻只能被一个线程访问，但是java的锁只能保证单机的时候有效

分布式锁就是 满足分布式系统下多进程可见并且互斥的锁。

实现思路 整个系统提供一个全局唯一的获取锁的东西

满足特性

互斥

安全

高性能

多进程可见

常见

mysql、redis、zookeeper

mysql性能一般  

redis实现 string结构

setnx key test

 set if not exist

del key

## 分布式锁原理

setnx命令

## 分布式锁结构



## mysql和redis怎么用的分布式锁



# 消息队列

## 刚刚说可以实现消息队列 谈谈mq

mq的场景

- 解耦
- 异步
- 削峰

解耦

如果A除了插入数据库，还要增加日志文件 还要发邮件，就要在原有代码扩展，如果使用MQ就放入消息队列中 ，从MQ获取消息在处理  好处是提高灵活性，扩展性

异步

将一些非核心流程，日志、短信、邮件 通过MQ方式异步处理，缩短主流程响应时间，提高用户体验

削峰

MQ本质是业务的排队。好处是避免高并发压垮系统的关键组件

缺点

1.系统可用性降低：系统引入的外部依赖越多，越容易挂掉。

2.系统复杂度提高：一致性问题、如何保证消息不被重复消费、如何保
证消息可靠性传输等。

3.一致性问题：A处理成功直接返回  接受消息的BCD  有一个写库失败 就不一致

# 主从 哨兵 集群

## 主从复制

### --概念



## --介绍下集群

## redis分布式怎么做 知道哨兵吗

## 介绍下集群cluster

主从复制和哨兵都是为了提高可用性，不是为了缓解缓存数据量过大的问题

redis切片集群  缓解压力

Redis 切片集群 就是部署多台 Redis 主节点（master），这些节点之间平等，并没有主从之说，同时对外提供读/写服务。缓存的数据库相对均匀地分布在这些 Redis 实例上，客户端的请求通过路由规则转发到目标 master 上。

## 3.redis 用的什么模式

单机模式 （有单机 主从 哨兵 集群

## 4.哨兵模式和集群模式的区别

## 5.哪一个支持的并发度更高

## 分片集群

## 哨兵机制

## redis怎么做主从，集群
